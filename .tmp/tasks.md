# タスクリスト - Django REST Framework バックエンド移行

## 概要

- 総タスク数: 25タスク
- 推定作業時間: 3-4日
- 優先度: 高

## タスク一覧

### Phase 1: 環境構築・準備

#### Task 1.1: Django プロジェクト基盤構築

- [ ] backendディレクトリの作成
- [ ] Django プロジェクト作成 (blog_project)
- [ ] 必要なPythonパッケージのrequirements.txt作成
- [ ] 基本設定ファイル構造の作成 (settings/base.py, development.py, production.py)
- [ ] 基本的なDjango設定 (INSTALLED_APPS, MIDDLEWARE)
- **完了条件**: Django プロジェクトが正常に起動する
- **依存**: なし
- **推定時間**: 1時間

#### Task 1.2: Docker環境構築

- [ ] Dockerfile作成
- [ ] docker-compose.yml作成 (PostgreSQL, Django, Next.js)
- [ ] .env.example作成
- [ ] Docker設定のテスト
- **完了条件**: docker-compose upでコンテナが正常起動する
- **依存**: Task 1.1
- **推定時間**: 1.5時間

#### Task 1.3: Django基本アプリ作成

- [ ] blogアプリの作成
- [ ] authenticationアプリの作成
- [ ] アプリの基本構造確認
- [ ] INSTALLED_APPSへの登録
- **完了条件**: 両アプリが正常に登録される
- **依存**: Task 1.1
- **推定時間**: 30分

### Phase 2: データモデル実装

#### Task 2.1: カスタムユーザーモデル実装

- [ ] User モデル (AbstractUser拡張) 実装
- [ ] SocialLink モデル実装
- [ ] Author モデル実装
- [ ] マイグレーション作成・実行
- [ ] Django Admin設定
- **完了条件**: ユーザー関連モデルが正常に作成される
- **依存**: Task 1.3
- **推定時間**: 2時間

#### Task 2.2: コンテンツモデル実装

- [ ] Category モデル実装
- [ ] Tag モデル実装
- [ ] マイグレーション作成・実行
- [ ] Django Admin設定
- [ ] slug自動生成機能実装
- **完了条件**: カテゴリ・タグモデルが正常に作成される
- **依存**: Task 2.1
- **推定時間**: 1.5時間

#### Task 2.3: BlogPost モデル実装

- [ ] BlogPost モデル実装 (SEOフィールド含む)
- [ ] インデックス設定追加
- [ ] マイグレーション作成・実行
- [ ] Django Admin設定 (リッチエディタ対応)
- [ ] published_at自動設定機能
- **完了条件**: ブログ記事モデルが正常に作成される
- **依存**: Task 2.2
- **推定時間**: 2時間

#### Task 2.4: Comment モデル実装

- [ ] Comment モデル実装
- [ ] 承認システム機能
- [ ] マイグレーション作成・実行
- [ ] Django Admin設定 (承認アクション)
- **完了条件**: コメントモデルが正常に作成される
- **依存**: Task 2.3
- **推定時間**: 1時間

### Phase 3: 認証システム実装

#### Task 3.1: django-allauth基本設定

- [ ] django-allauth設定追加
- [ ] JWT設定実装
- [ ] カスタムシリアライザー実装
- [ ] 認証URL設定
- **完了条件**: 基本認証機能が動作する
- **依存**: Task 2.1
- **推定時間**: 2時間

#### Task 3.2: 権限システム実装

- [ ] カスタム権限クラス実装 (IsAuthorOrReadOnly等)
- [ ] 権限テスト実装
- [ ] 権限設定のテスト
- **完了条件**: 権限システムが正常に動作する
- **依存**: Task 3.1
- **推定時間**: 1時間

#### Task 3.3: NextAuth.js連携準備

- [ ] JWTカスタマイゼーション
- [ ] フロントエンド向けのエンドポイント設計
- [ ] CORS設定実装
- **完了条件**: NextAuth.jsとの連携準備が完了
- **依存**: Task 3.1
- **推定時間**: 1.5時間

### Phase 4: API実装

#### Task 4.1: 基本Serializers実装

- [ ] AuthorSerializer実装
- [ ] CategorySerializer実装
- [ ] TagSerializer実装
- [ ] SocialLinkSerializer実装
- **完了条件**: 基本serializersが動作する
- **依存**: Task 2.4
- **推定時間**: 1.5時間

#### Task 4.2: BlogPost Serializers実装

- [ ] BlogPostListSerializer実装
- [ ] BlogPostDetailSerializer実装
- [ ] フィールド選択最適化
- [ ] ネストシリアライザー設定
- **完了条件**: ブログ記事APIが動作する
- **依存**: Task 4.1
- **推定時間**: 1.5時間

#### Task 4.3: Comment Serializers実装

- [ ] CommentSerializer実装
- [ ] データバリデーション実装 (bleach等)
- [ ] 承認ステータス管理
- **完了条件**: コメントAPIが動作する
- **依存**: Task 4.2
- **推定時間**: 1時間

#### Task 4.4: ViewSets実装

- [ ] BlogPostViewSet実装
- [ ] CategoryViewSet実装
- [ ] TagViewSet実装
- [ ] AuthorViewSet実装
- [ ] CommentViewSet実装
- **完了条件**: 全ViewSetsが動作する
- **依存**: Task 4.3
- **推定時間**: 2.5時間

#### Task 4.5: 検索・フィルタリング実装

- [ ] DjangoFilterBackend設定
- [ ] BlogPostFilter実装
- [ ] 全文検索機能実装
- [ ] 並び替え機能実装
- **完了条件**: 検索・フィルタリングが動作する
- **依存**: Task 4.4
- **推定時間**: 2時間

#### Task 4.6: ページネーション実装

- [ ] カスタムページネーションクラス実装
- [ ] レスポンス形式の統一
- [ ] ページ情報の追加
- **完了条件**: ページネーションが動作する
- **依存**: Task 4.5
- **推定時間**: 1時間

### Phase 5: セキュリティ・最適化

#### Task 5.1: セキュリティ設定実装

- [ ] CORS詳細設定
- [ ] セキュリティミドルウェア設定
- [ ] CSRFトークン設定
- [ ] XSS対策実装
- **完了条件**: セキュリティ設定が有効になる
- **依存**: Task 4.6
- **推定時間**: 1.5時間

#### Task 5.2: パフォーマンス最適化

- [ ] データベースクエリ最適化 (select_related, prefetch_related)
- [ ] インデックス追加
- [ ] キャッシュ設定実装
- [ ] N+1問題の解決
- **完了条件**: API応答時間が200ms以下になる
- **依存**: Task 5.1
- **推定時間**: 2時間

### Phase 6: テスト実装

#### Task 6.1: モデルテスト実装

- [ ] User/Authorモデルテスト
- [ ] BlogPost/Category/Tagモデルテスト
- [ ] Commentモデルテスト
- [ ] モデル関係テスト
- **完了条件**: モデルテストが80%以上のカバレッジ
- **依存**: Task 5.2
- **推定時間**: 2時間

#### Task 6.2: APIテスト実装

- [ ] 認証APIテスト
- [ ] ブログAPIテスト (CRUD)
- [ ] 検索・フィルタリングテスト
- [ ] 権限テスト
- **完了条件**: APIテストが80%以上のカバレッジ
- **依存**: Task 6.1
- **推定時間**: 2.5時間

#### Task 6.3: セキュリティテスト実装

- [ ] 認証テスト
- [ ] 権限テスト
- [ ] データバリデーションテスト
- [ ] CORS テスト
- **完了条件**: セキュリティテストが通る
- **依存**: Task 6.2
- **推定時間**: 1時間

### Phase 7: データ移行・統合

#### Task 7.1: データ移行スクリプト作成

- [ ] モックデータ分析
- [ ] マイグレーションスクリプト作成
- [ ] データ整合性チェック機能
- [ ] ロールバック機能実装
- **完了条件**: モックデータが正常にDjangoに移行される
- **依存**: Task 6.3
- **推定時間**: 2時間

#### Task 7.2: フロントエンド統合準備

- [ ] API レスポンス形式の互換性確認
- [ ] エラーレスポンス統一
- [ ] 既存TypeScript型との互換性確認
- [ ] API仕様書作成 (OpenAPI)
- **完了条件**: フロントエンドとの互換性が確保される
- **依存**: Task 7.1
- **推定時間**: 2時間

#### Task 7.3: 本番環境設定

- [ ] 環境変数設定完備
- [ ] 本番用Docker設定
- [ ] ログ設定実装
- [ ] ヘルスチェックエンドポイント実装
- **完了条件**: 本番デプロイ準備が完了
- **依存**: Task 7.2
- **推定時間**: 1.5時間

### Phase 8: 最終検証・仕上げ

#### Task 8.1: 統合テスト

- [ ] フロントエンドとバックエンドの統合テスト
- [ ] 全機能の動作確認
- [ ] パフォーマンステスト
- [ ] セキュリティテスト
- **完了条件**: 全機能が正常に動作する
- **依存**: Task 7.3
- **推定時間**: 2時間

#### Task 8.2: ドキュメント作成

- [ ] README.md更新
- [ ] API仕様書完成
- [ ] デプロイ手順書作成
- [ ] トラブルシューティングガイド作成
- **完了条件**: 完全なドキュメントが完成
- **依存**: Task 8.1
- **推定時間**: 1.5時間

## 実装順序

1. **Phase 1-2**: 環境構築とデータモデル実装 (並行実行可能: Task 1.2と1.3)
2. **Phase 3**: 認証システム実装 (Task 3.1→3.2→3.3の順)
3. **Phase 4**: API実装 (Task 4.1→4.2→4.3→4.4→4.5→4.6の順)
4. **Phase 5**: セキュリティ・最適化 (Task 5.1→5.2の順)
5. **Phase 6**: テスト実装 (Task 6.1→6.2→6.3の順)
6. **Phase 7**: データ移行・統合 (Task 7.1→7.2→7.3の順)
7. **Phase 8**: 最終検証・仕上げ (Task 8.1→8.2の順)

## 並行実行可能なタスク

- **Phase 1**: Task 1.2とTask 1.3
- **Phase 2**: Task 2.2とTask 2.1完了後のAdmin設定
- **Phase 4**: Task 4.1の各Serializer
- **Phase 6**: Task 6.1とTask 6.2の一部

## リスクと対策

- **認証統合の複雑性**: 段階的実装とテスト強化で対応
- **データ移行の複雑性**: 十分なテストとロールバック機能で対応
- **パフォーマンス問題**: 早期の最適化とベンチマークで対応
- **フロントエンド互換性**: 継続的な統合テストで対応
- **Docker環境の複雑性**: 詳細な文書化と段階的構築で対応

## 注意事項

- 各タスクはコミット単位で完結させる
- タスク完了時は必要に応じて品質チェック (lint, type-check) を実行
- 不明点は実装前に確認する
- APIの互換性は常に既存フロントエンドとの整合性を考慮する
- セキュリティ設定は各段階で確認する

## 実装開始ガイド

1. このタスクリストに従って順次実装を進めてください
2. 各タスクの開始時にTodoWriteでin_progressに更新
3. 完了時はcompletedに更新
4. 問題発生時は速やかに報告してください
5. 各Phaseの完了時にマイルストーン確認を実施
6. 継続的なテストとコードレビューを実施