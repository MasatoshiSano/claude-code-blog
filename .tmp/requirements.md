# 要件定義書 - Django REST Framework バックエンド移行

## 1. 目的

現在Next.jsアプリケーションで使用しているモックデータシステムを、Python Django + Django REST Frameworkを用いた本格的なバックエンドAPIに移行し、スケーラブルで保守性の高いブログシステムを構築する。

## 2. 機能要件

### 2.1 必須機能

#### 2.1.1 コンテンツ管理
- [ ] ブログ記事のCRUD操作（作成、読み取り、更新、削除）
- [ ] カテゴリの管理（CRUD操作）
- [ ] タグの管理（CRUD操作）
- [ ] 著者情報の管理
- [ ] Markdownコンテンツの処理とHTML変換

#### 2.1.2 認証・認可
- [ ] ユーザー認証システム（ログイン・ログアウト）
- [ ] 管理者権限とゲスト権限の分離
- [ ] JWT トークンベースの認証
- [ ] NextAuth.jsとの連携
- [ ] django-allauthによるソーシャル認証対応
- [ ] メール認証機能

#### 2.1.3 コメントシステム
- [ ] コメントの投稿・表示
- [ ] コメント承認システム（管理者による承認）
- [ ] コメントの返信機能

#### 2.1.4 検索・フィルタリング
- [ ] ブログ記事の全文検索
- [ ] カテゴリによるフィルタリング
- [ ] タグによるフィルタリング
- [ ] 公開日による並び替え

#### 2.1.5 RESTful API
- [ ] `/api/posts/` - ブログ記事エンドポイント
- [ ] `/api/categories/` - カテゴリエンドポイント
- [ ] `/api/tags/` - タグエンドポイント
- [ ] `/api/authors/` - 著者エンドポイント
- [ ] `/api/comments/` - コメントエンドポイント
- [ ] `/api/auth/` - 認証エンドポイント

### 2.2 オプション機能

- [ ] 記事の下書き保存機能
- [ ] 記事の予約投稿機能
- [ ] 画像アップロード機能
- [ ] SEOメタデータの管理
- [ ] アクセス統計の収集
- [ ] ソーシャルログイン（Google、GitHub等）の実装

## 3. 非機能要件

### 3.1 パフォーマンス

- API応答時間: 95%のリクエストで200ms以下
- データベースクエリの最適化（N+1問題の回避）
- ページネーション実装（1ページあたり最大20件）
- 適切なキャッシュ戦略の実装

### 3.2 セキュリティ

- CORS設定によるNext.jsフロントエンドからのアクセス制御
- SQLインジェクション対策（Djangoの標準機能使用）
- XSS対策（適切なデータサニタイゼーション）
- CSRF保護の実装
- 機密情報の環境変数管理

### 3.3 保守性

- Django REST Frameworkのベストプラクティスに従った実装
- 適切なコード分割（models、views、serializers、urls）
- 包括的なテストカバレッジ（80%以上）
- API仕様のドキュメント化（OpenAPI/Swagger）

### 3.4 互換性

- 既存のNext.jsフロントエンドとの完全互換性
- 現在のデータ構造との互換性維持
- Python 3.9+の対応
- Django 4.2+ LTSの使用

## 4. 制約事項

### 4.1 技術的制約

- **バックエンド**: Django 4.2+ + Django REST Framework
- **認証システム**: django-allauth + JWT + NextAuth.js連携
- **データベース**: PostgreSQL（本番環境）、SQLite（開発環境）
- **デプロイメント**: Docker Compose
- **既存フロントエンド**: Next.js 14を維持（API統合のみ変更）

### 4.2 ビジネス制約

- 既存の機能を損なうことなく移行
- フロントエンドの大幅な変更は避ける
- 段階的な移行を可能にする設計

## 5. 成功基準

### 5.1 完了の定義

- [ ] 全てのモックデータ機能がDjangoバックエンドで再現されている
- [ ] Next.jsフロントエンドが新しいAPIと完全に統合されている
- [ ] 管理者画面（Django Admin）でコンテンツ管理が可能
- [ ] 全ての既存機能が正常に動作している
- [ ] API仕様書が完備されている

### 5.2 受け入れテスト

- フロントエンドから全ての記事が表示される
- 新しい記事の投稿・編集・削除が可能
- カテゴリ・タグによるフィルタリングが動作する
- コメント機能が正常に動作する
- 認証機能が正常に動作する

## 6. 想定されるリスク

### 6.1 技術リスク
- **データ移行の複雑性**: モックデータからDjangoモデルへの移行時のデータ構造変更
- **認証統合の複雑性**: django-allauth + NextAuth.jsの統合
- **CORS設定**: フロントエンドとバックエンドの通信設定
- **Docker環境の複雑性**: 開発・本番環境の設定差異

### 6.2 対策
- 段階的な移行アプローチを採用
- 詳細なAPIテストの実装
- 開発環境での十分な検証
- Docker環境の統一と文書化

## 7. 今後の検討事項

### 7.1 設計フェーズで詳細化すべき事項

- データベーススキーマの詳細設計
- API エンドポイントの詳細仕様
- 認証フローの詳細設計
- デプロイメント戦略（Docker Compose環境構築）
- データ移行スクリプトの設計
- テスト戦略の詳細化
- django-allauth設定とNextAuth.js連携方法
- CORS設定とフロントエンド統合

### 7.2 プロジェクト構造

```
backend/
├── blog_project/          # Django プロジェクト
│   ├── settings/          # 環境別設定
│   │   ├── base.py        # 基本設定
│   │   ├── development.py # 開発環境
│   │   └── production.py  # 本番環境
│   ├── urls.py
│   └── wsgi.py
├── blog/                  # メインアプリ
│   ├── models.py          # データモデル
│   ├── serializers.py     # DRF シリアライザー
│   ├── views.py           # API ビュー
│   ├── urls.py            # URL 設定
│   └── admin.py           # 管理画面設定
├── authentication/       # 認証アプリ（django-allauth設定）
├── requirements.txt       # 依存関係
├── Dockerfile            # Docker設定
├── docker-compose.yml    # Docker Compose設定
├── .env.example          # 環境変数テンプレート
└── manage.py
```

## 8. データモデル概要

### 8.1 主要モデル
- **BlogPost**: タイトル、内容、スラッグ、公開日、カテゴリ、タグ、著者
- **Category**: 名前、説明、スラッグ
- **Tag**: 名前、スラッグ
- **Author**: ユーザー情報、プロフィール
- **Comment**: 内容、投稿者、記事、承認状態

### 8.2 リレーション
- BlogPost ↔ Category (多対一)
- BlogPost ↔ Tag (多対多)
- BlogPost ↔ Author (多対一)
- BlogPost ↔ Comment (一対多)